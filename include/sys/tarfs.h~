#ifndef _TARFS_H
#define _TARFS_H

<<<<<<< HEAD
#include <sys/defs.h>

||||||| merged common ancestors
=======
#include<sys/defs.h>
#include<sys/utils.h>
#define	 OPEN_FILE_LIMIT		512


/* Values used in typeflag field.  */
#define REGTYPE  '0'            /* regular file */
#define AREGTYPE '\0'           /* regular file */
#define LNKTYPE  '1'            /* link */
#define SYMTYPE  '2'            /* reserved */
#define CHRTYPE  '3'            /* character special */
#define BLKTYPE  '4'            /* block special */
#define DIRTYPE  '5'            /* directory */
#define FIFOTYPE '6'            /* FIFO special */
#define CONTTYPE '7'            /* reserved */

/* tar Header Block, from POSIX 1003.1-1990.  */

/* POSIX header.  */



#define TMAGIC   "ustar"        /* ustar and a null */
#define TMAGLEN  6
#define TVERSION "00"           /* 00 and no null */
#define TVERSLEN 2

/* Values used in typeflag field.  */
#define REGTYPE  '0'            /* regular file */
#define AREGTYPE '\0'           /* regular file */
#define LNKTYPE  '1'            /* link */
#define SYMTYPE  '2'            /* reserved */
#define CHRTYPE  '3'            /* character special */
#define BLKTYPE  '4'            /* block special */
#define DIRTYPE  '5'            /* directory */
#define FIFOTYPE '6'            /* FIFO special */
#define CONTTYPE '7'            /* reserved */

>>>>>>> e6b7680e5219ebb988e754c6b9877e247e68c3b1
extern char _binary_tarfs_start;
extern char _binary_tarfs_end;


//https://www.gnu.org/software/tar/manual/html_node/Standard.html
struct tarfs_fd {
    char name[100];
    //char match_source[20];
    int type;
    int mode;
    uint64_t size;
    uint64_t fd_index;
    uint64_t offset;
    void *data;
};


struct posix_header_ustar
{                              /* byte offset */
  char name[100];               /*   0 */
  char mode[8];                 /* 100 */
  char uid[8];                  /* 108 */
  char gid[8];                  /* 116 */
  char size[12];                /* 124 */
  char mtime[12];               /* 136 */
  char chksum[8];               /* 148 */
  char typeflag;                /* 156 */
  char linkname[100];           /* 157 */
  char magic[6];                /* 257 */
  char version[2];              /* 263 */
  char uname[32];               /* 265 */
  char gname[32];               /* 297 */
  char devmajor[8];             /* 329 */
  char devminor[8];             /* 337 */
  char prefix[155];             /* 345 */
  char padding[12];             /* 500 */ //not working without padding.
};

<<<<<<< HEAD
#define	 OPEN_FILE_LIMIT		512

#define TMAGIC   "ustar"        /* ustar and a null */
#define TMAGLEN  6
#define TVERSION "00"           /* 00 and no null */
#define TVERSLEN 2

/* Values used in typeflag field.  */
#define REGTYPE  0            /* regular file */
//#define AREGTYPE '\0'           /* regular file */
#define LNKTYPE  1            /* link */
#define SYMTYPE  2            /* reserved */
#define CHRTYPE  3            /* character special */
#define BLKTYPE  4            /* block special */
#define DIRTYPE  5            /* directory */
#define FIFOTYPE 6            /* FIFO special */
#define CONTTYPE 7            /* reserved */



//https://www.gnu.org/software/tar/manual/html_node/Standard.html
struct tarfs_fd {
    char name[100];
    //char match_source[20];
    int type;
    int mode;
    uint64_t size;
    uint64_t fd_index;
    uint64_t offset;
    void *data;
};

typedef struct posix_header_ustar posix_header_ustar;

struct tarfs_fd tarfs_fds[OPEN_FILE_LIMIT];

void init_tarfs();
void *get_bin_info(const char *fname);
int syscall_open(const char *fname ,  int flag);
uint32_t get_index_by_name(const char* fname);
uint32_t get_child(uint32_t fd_idx , uint32_t child_fidx);

||||||| merged common ancestors
=======

typedef struct posix_header_ustar posix_header_ustar;

struct tarfs_fd tarfs_fds[OPEN_FILE_LIMIT];

void init_tarfs();
void *get_bin_info(const char *fname);
int syscall_open(const char *fname ,  int flag);
uint32_t get_index_by_name(const char* fname);
uint32_t get_child(uint32_t fd_idx , uint32_t child_fidx);

>>>>>>> e6b7680e5219ebb988e754c6b9877e247e68c3b1
#endif
